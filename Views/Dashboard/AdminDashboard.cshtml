@{
    ViewData["Title"] = "Admin Dashboard";
    int adminCount = ViewData["AdminCount"] != null ? (int)ViewData["AdminCount"] : 0;
    Layout = "~/Views/Shared/_Layout.cshtml";
}
  <div class="welcome" style="color: #0d6efd;">
<h2>Welcome @User.Identity.Name</h2>
</div>


<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<div class="admin-layout">
    <aside class="sidebar">
        <h2>
            <img src="/images/administrator-male.png" alt="Admin Icon" style="width:30px; height:30px; vertical-align:middle; margin-right:10px;">
            Admin Panel
        </h2>
        <ul>
            <li><a href="/Admin/TaskAssigner"><img src="/images/Employeetask1.png" alt="Tasks" style="width:20px; height:20px; vertical-align:middle; margin-right:8px;">Assign Tasks</a></li>
            <li><a href="/Admin/AssignTeamTask"><img src="/images/assignteamtask.png" alt="Tasks" style="width:20px; height:20px; vertical-align:middle; margin-right:8px;">Assign Team Task</a></li>
            <li><a href="/Admin/chat"><img src="/images/Employeemessage1.png" alt="Tasks" style="width:20px; height:20px; vertical-align:middle; margin-right:8px;">Messages</a></li>
            <li><a href="/Admin/ShowAssignedTasks"><img src="/images/Employeetask1.png" alt="Tasks" style="width:20px; height:20px; vertical-align:middle; margin-right:8px;">All Tasks</a></li>
            <li><a asp-controller="Team" asp-action="Add"><img src="/images/teams.png" alt="Tasks" style="width:20px; height:20px; vertical-align:middle; margin-right:8px;">Add Team</a></li>
            <li><a asp-controller="Team" asp-action="List"><img src="/images/teams.png" alt="Tasks" style="width:20px; height:20px; vertical-align:middle; margin-right:8px;">Show Teams</a></li>
            <li><a asp-controller="Admin" asp-action="LeaveDashboard"><img src="/images/EmployeeleaveStatus.png" alt="Tasks" style="width:20px; height:20px; vertical-align:middle; margin-right:8px;">Leave Permissions</a></li>
        </ul>
    </aside>

     

    <main class="dashboard-content">
       
        <div class="card-admin">
            <h3>Total Admins</h3>
            <p>@adminCount</p>
        </div>

       <div class="card">
            <h3>Total Tasks Assigned</h3>
            <p id="totalTasks">Loading...</p>
        </div>


       <div class="card">
            <h3>Monthly Tasks Assigned</h3>
            <p id="totalTasks">Loading...</p>
            <canvas id="taskAssignChart" height="100"></canvas>
        </div>


        <div class="card">
            <h3>Monthly Task Completion Trend</h3>
            <canvas id="taskCompleteChart"></canvas>
        </div>

        <div class="card">
            <h3>Total Employees</h3>
            <p id="totalEmployees">Loading...</p>
        </div>


        <div class="card clock-card">
            <h3>Real-Time Clock</h3>
            <p id="clock"></p>
        </div>
    </main>
</div>

<script>
    function updateClock() {
        const now = new Date();
        const hours = now.getHours().toString().padStart(2, '0');
        const minutes = now.getMinutes().toString().padStart(2, '0');
        const seconds = now.getSeconds().toString().padStart(2, '0');
        const timeString = `${hours}:${minutes}:${seconds}`;
        document.getElementById('clock').innerText = timeString;
    }
    setInterval(updateClock, 1000);
    updateClock();



    document.addEventListener("DOMContentLoaded", function () {
        // Total tasks count
        fetch('/Admin/GetTotalTasksAssignedByAdmin')
            .then(response => response.json())
            .then(count => {
                document.getElementById('totalTasks').textContent = count;
            })
            .catch(() => {
                document.getElementById('totalTasks').textContent = 'Error';
            });

        // Monthly chart data
        fetch('/Admin/GetMonthlyTaskAssignmentsByAdmin')
            .then(response => response.json())
            .then(data => {
                const ctx = document.getElementById('taskAssignChart').getContext('2d');
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ["Jan", "Feb", "Mar", "Apr", "May", "Jun",
                                 "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
                        datasets: [{
                            label: "Tasks Assigned",
                            data: data,
                            backgroundColor: 'rgba(75, 192, 192, 0.5)',
                            borderColor: 'rgba(75, 192, 192, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                precision: 0
                            }
                        }
                    }
                });
            })
            .catch(error => {
                console.error('Failed to fetch monthly task data:', error);
            });
    });



    const taskCompleteData = {
        labels: taskAssignData.labels,
        datasets: [{
            label: "Tasks Completed",
            data: [8, 13, 10, 16, 20, 22, 18, 15, 17, 20, 19, 24], // Change with actual data
            backgroundColor: 'rgba(75, 192, 192, 0.6)',
            borderColor: 'rgba(75, 192, 192, 1)',
            borderWidth: 2,
            fill: true,
            tension: 0.3
        }]
    };

    const configAssign = {
        type: 'line',
        data: taskAssignData,
        options: {
            responsive: true,
            plugins: {
                legend: { position: 'top' },
                title: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Number of Tasks'
                    }
                }
            }
        }
    };

    const configComplete = {
        type: 'line',
        data: taskCompleteData,
        options: configAssign.options
    };

    // Render both charts
    window.onload = function () {
        const ctxAssign = document.getElementById('taskAssignChart').getContext('2d');
        const ctxComplete = document.getElementById('taskCompleteChart').getContext('2d');

        new Chart(ctxAssign, configAssign);
        new Chart(ctxComplete, configComplete);
    };

@* 
    document.addEventListener("DOMContentLoaded", function () {
        fetch('/Admin/GetTotalTasksAssignedByAdmin')
            .then(response => {
                if (!response.ok) throw new Error("Failed to fetch task count");
                return response.json();
            })
            .then(count => {
                document.getElementById('totalTasks').textContent = count;
            })
            .catch(error => {
                console.error("Error loading total tasks:", error);
                document.getElementById('totalTasks').textContent = 'Error';
            });
    }); *@

    //employees

document.addEventListener("DOMContentLoaded", function () {
    fetch('/Admin/GetTotalEmployees')
        .then(response => {
            if (!response.ok) throw new Error("Failed to fetch total employees");
            return response.json();
        })
        .then(count => {
            document.getElementById('totalEmployees').textContent = count;
        })
        .catch(error => {
            console.error("Error loading total employees:", error);
            document.getElementById('totalEmployees').textContent = 'Error';
        });
});


document.addEventListener("DOMContentLoaded", function () {
    fetch('/Admin/GetMonthlyTaskCompletion')
        .then(response => {
            if (!response.ok) throw new Error("Failed to fetch monthly task data");
            return response.json();
        })
        .then(data => {
            const labels = data.map(d => d.month);
            const taskCounts = data.map(d => d.completedTasks);

            const ctx = document.getElementById('taskCompleteChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Completed Tasks',
                        data: taskCounts,
                        backgroundColor: 'rgba(54, 162, 235, 0.6)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Tasks Completed'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Month'
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Monthly Task Completion Trend'
                        }
                    }
                }
            });
        })
        .catch(error => {
            console.error("Chart error:", error);
        });
});


    


</script>

<style>
    .welcome{
        margin-left: 500px;
    }

    body {
        margin: 0;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: #f1f3f6;
    }

    .admin-layout {
        display: flex;
        min-height: 100vh;
    }

    .sidebar {
        width: 240px;
        background-color: #2c3e50;
        color: #ecf0f1;
        padding: 25px 20px;
        position: fixed;
        top: 0;
        bottom: 0;
        left: 0;
        overflow-y: auto;
        margin-top: 55px;
    }

    .sidebar h2 {
        font-size: 18px;
        font-weight: 700;
        margin-bottom: 20px;
        text-align: center;
        border-bottom: 1px solid #34495e;
        padding-bottom: 10px;
        text-transform: uppercase;
    }

    .sidebar ul {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .sidebar ul li {
        margin-bottom: 12px;
    }

    .sidebar ul li a {
        display: block;
        padding: 10px 14px;
        color: #ecf0f1;
        font-size: 15px;
        text-decoration: none;
        border-radius: 6px;
        transition: background 0.2s ease;
    }

    .sidebar ul li a:hover {
        background-color: #1abc9c;
    }

    /* Modern Dashboard Styles */
:root {
  --primary: #4361ee;
  --primary-light: #3f37c9;
  --secondary: #3a0ca3;
  --accent: #7209b7;
  --dark: #212529;
  --light: #f8f9fa;
  --success: #4cc9f0;
  --warning: #f8961e;
  --danger: #f72585;
  --gray: #6c757d;
  --white: #ffffff;
}

body {
  margin: 0;
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
  background-color: #f5f7fa;
  color: var(--dark);
}

/* Layout */
.admin-layout {
  display: flex;
  min-height: 100vh;
}

/* Dashboard Content - Matching Image Layout */
.dashboard-content {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  grid-template-rows: auto auto auto;
  gap: 24px;
  padding: 32px;
  margin-left: 260px;
  background-color: #f4f6f8;
  min-height: 100vh;
  box-sizing: border-box;
  
}

/* Card Grid Positioning */
.card-admin {
  grid-column: 1;
  grid-row: 1;
}

.card:nth-of-type(1) { /* Total Tasks Assigned */
  grid-column: 2;
  grid-row: 1;
}

.card:nth-of-type(2) { /* Monthly Task Assign Trend */
  grid-column: 1 / span 2;
  grid-row: 2;
}

.card:nth-of-type(3) { /* Monthly Task Completion Trend */
  grid-column: 3;
  grid-row: 1 / span 2;
}

.card:nth-of-type(4) { /* Total Employees */
  grid-column: 3;
  grid-row: 3;
}

.clock-card {
  grid-column: 1;
  grid-row: 3;
}

/* Card Styles */
.card, .card-admin, .clock-card {
  background-color: #fff;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
  padding: 24px;
  display: flex;
  flex-direction: column;
  transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
  border-left: 4px solid transparent;
}

.card:hover, .card-admin:hover, .clock-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
}

.card h3, .card-admin h3, .clock-card h3 {
  font-size: 18px;
  margin-bottom: 16px;
  color: var(--gray);
  font-weight: 500;
  letter-spacing: 0.5px;
}

.card p, .card-admin p, .clock-card p {
  font-size: 28px;
  font-weight: 700;
  color: var(--dark);
  margin: 0;
}

/* Specific Card Styles */
.card-admin {
  border-left-color: var(--accent);
}

.card-admin p {
  color: var(--accent);
}

.clock-card {
  background: linear-gradient(135deg, #2b2d42, #1a1a2e);
  color: var(--white);
  text-align: center;
  justify-content: center;
}

.clock-card h3 {
  color: var(--success);
  margin-bottom: 24px;
}

#clock {
  font-size: 32px;
  font-weight: 700;
  letter-spacing: 1px;
  font-family: 'Fira Code', monospace;
  color: var(--white);
}

/* Chart Containers */
.card canvas {
  width: 100% !important;
  height: 100% !important;
  min-height: 200px;
  margin-top: 16px;
}

/* Responsive Adjustments */

  .dashboard-content {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .card:nth-of-type(3) {
    grid-column: 1 / span 2;
    grid-row: 3;
  }
  
  .card:nth-of-type(4) {
    grid-column: 1;
    grid-row: 4;
  }
  
  .clock-card {
    grid-column: 2;
    grid-row: 4;
  }
}


   
</style>
